[[RSG]] [[20190720]] [[gcc]] [[gztool]] :<#compilar estáticamente en windows y linux> 


odroid@odroid64:~/SD/dev/zlib/examples$ gcc -g -O0 -o gztool gztool.c -L.. ../libz.so.1.2.11 -I..


.................................................


++++++++++++++++++++++++
#include <zlib.h>
++++++++++++++++++++++++


odroid@odroid64:~/SD/dev/zlib/examples$ gcc -g -O0 -o gztool2 gztool.c -lz
odroid@odroid64:~/SD/dev/zlib/examples$ ls -l gztool2 gztool
    -rwxrwxr-x 1 odroid odroid 45000 Jul 20 03:08 gztool
    -rwxrwxr-x 1 odroid odroid 45008 Jul 20 12:50 gztool2
odroid@odroid64:~/SD/dev/zlib/examples$ ldd -d gztool2 gztool
    gztool2:
            linux-vdso.so.1 =>  (0x0000007f7cbd8000)
            libz.so.1 => /lib/aarch64-linux-gnu/libz.so.1 (0x0000007f7cb92000)
            libc.so.6 => /lib/aarch64-linux-gnu/libc.so.6 (0x0000007f7ca4b000)
            /lib/ld-linux-aarch64.so.1 (0x000000558fd2e000)
    gztool:
            linux-vdso.so.1 =>  (0x0000007f81772000)
            libz.so.1 => /lib/aarch64-linux-gnu/libz.so.1 (0x0000007f8172c000)
            libc.so.6 => /lib/aarch64-linux-gnu/libc.so.6 (0x0000007f815e5000)
            /lib/ld-linux-aarch64.so.1 (0x000000557eafe000)

No parece que el comando de compilación original usara la librería compilada en ..,
sino la del sistema
:-o

.................................................


roberto@murgen  /d/temporal/zlib/examples
$ gcc -g -O0 -L. ../libz.so.1.2.11 -I.. -o gztool gztool.c

roberto@murgen  /d/temporal/zlib/examples
$ ldd gztool.exe
        ntdll.dll => /c/Windows/SYSTEM32/ntdll.dll (0x76e10000)
        kernel32.dll => /c/Windows/system32/kernel32.dll (0x76cf0000)
        KERNELBASE.dll => /c/Windows/system32/KERNELBASE.dll (0x7fefcae0000)
        libz.so.1.2.11 => /d/temporal/zlib/examples/libz.so.1.2.11 (0x6fbc0000)
        msvcrt.dll => /c/Windows/system32/msvcrt.dll (0x7fefee90000)
        USER32.dll => /c/Windows/system32/USER32.dll (0x76bf0000)
        GDI32.dll => /c/Windows/system32/GDI32.dll (0x7fefdc00000)
        LPK.dll => /c/Windows/system32/LPK.dll (0x7fefd300000)
        USP10.dll => /c/Windows/system32/USP10.dll (0x7fefcdb0000)
        IMM32.DLL => /c/Windows/system32/IMM32.DLL (0x7fefd310000)
        MSCTF.dll => /c/Windows/system32/MSCTF.dll (0x7fefda50000)
        ConEmuHk64.dll => /c/Program Files/ConEmu/ConEmu/ConEmuHk64.dll (0x7e110000)
        ADVAPI32.dll => /c/Windows/system32/ADVAPI32.dll (0x7feff020000)
        sechost.dll => /c/Windows/SYSTEM32/sechost.dll (0x7fefcd90000)
        RPCRT4.dll => /c/Windows/system32/RPCRT4.dll (0x7fefd1d0000)
        api-ms-win-core-synch-l1-2-0.DLL => /c/Windows/system32/api-ms-win-core-synch-l1-2-0.DLL (0x7fef5d80000)

roberto@murgen  /d/temporal/zlib/examples
$ gcc -static -g -O0 -I.. -o gztool2 gztool.c libz.a

Al parecer la posición donde se pone el libz.a importa (entre medias no funciona).

roberto@murgen  /d/temporal/zlib/examples
$ ls -l gztool2.exe
-rwxr-xr-x 1 roberto None 178802 Jul 20 13:08 gztool2.exe

roberto@murgen  /d/temporal/zlib/examples
$ ldd gztool2.exe
        ntdll.dll => /c/Windows/SYSTEM32/ntdll.dll (0x76e10000)
        kernel32.dll => /c/Windows/system32/kernel32.dll (0x76cf0000)
        KERNELBASE.dll => /c/Windows/system32/KERNELBASE.dll (0x7fefcae0000)
        msvcrt.dll => /c/Windows/system32/msvcrt.dll (0x7fefee90000)
        USER32.dll => /c/Windows/system32/USER32.dll (0x76bf0000)
        GDI32.dll => /c/Windows/system32/GDI32.dll (0x7fefdc00000)
        LPK.dll => /c/Windows/system32/LPK.dll (0x7fefd300000)
        USP10.dll => /c/Windows/system32/USP10.dll (0x7fefcdb0000)
        IMM32.DLL => /c/Windows/system32/IMM32.DLL (0x7fefd310000)
        MSCTF.dll => /c/Windows/system32/MSCTF.dll (0x7fefda50000)
        ConEmuHk64.dll => /c/Program Files/ConEmu/ConEmu/ConEmuHk64.dll (0x7e110000)
        ADVAPI32.dll => /c/Windows/system32/ADVAPI32.dll (0x7feff020000)
        sechost.dll => /c/Windows/SYSTEM32/sechost.dll (0x7fefcd90000)
        RPCRT4.dll => /c/Windows/system32/RPCRT4.dll (0x7fefd1d0000)
        api-ms-win-core-synch-l1-2-0.DLL => /c/Windows/system32/api-ms-win-core-synch-l1-2-0.DLL (0x7fef5d80000)




-------------------------------------------------------------------------------
[[RSG]] [[20190720]] 


D:\Instalaciones\GitHub reps\gztool>git commit
[master (root-commit) baac788] v0.1 initial release
 2 files changed, 2052 insertions(+)
 create mode 100644 README.md
 create mode 100644 gztool.c

D:\Instalaciones\GitHub reps\gztool>git push origin master
Counting objects: 4, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 17.98 KiB | 1.38 MiB/s, done.
Total 4 (delta 0), reused 0 (delta 0)
To https://github.com/circulosmeos/gztool.git
 * [new branch]      master -> master

D:\Instalaciones\GitHub reps\gztool>git tag -a "v0.1" -m "v0.1"

D:\Instalaciones\GitHub reps\gztool>git tag
v0.1

D:\Instalaciones\GitHub reps\gztool>git push origin master --tags
Counting objects: 1, done.
Writing objects: 100% (1/1), 162 bytes | 81.00 KiB/s, done.
Total 1 (delta 0), reused 0 (delta 0)
To https://github.com/circulosmeos/gztool.git
 * [new tag]         v0.1 -> v0.1


-------------------------------------------------------------------------------
[[RSG]] [[20190722]] [[valgrind]] [[massif]] [[memoria]] 

Consumo de memoria: puedo bajarlo considerablemente.

odroid@odroid64:~/SD/dev/zlib/examples$ valgrind --tool=massif ./gztool -fi TEST.gz blank.gz.gzi.gz output_file.gz bgzip_project.20190530.2.tar.gz

El fichero generado puede verse online en 
<http://flyingblindstudios.de/massifViz> 
(<http://boutglay.com/massifjs/>)

La salida es correcta con varios ficheros, y consume los esperados <2MiB (igual al mayor .gzi generado).
Y esos errores intermedios no sé si deben a sprintf o no ...

odroid@odroid64:~/SD/dev/zlib/examples$ valgrind ./gztool -fi TEST.gz blank.gz.gzi.gz output_file.gz bgzip_project.20190530.2.tar.gz
    ==22183== Memcheck, a memory error detector
    ==22183== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
    ==22183== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
    ==22183== Command: ./gztool -fi TEST.gz blank.gz.gzi.gz output_file.gz bgzip_project.20190530.2.tar.gz
    ==22183==

    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x484C5A4: strstr (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
    ==22183==
    Processing 'TEST.gz' ...
    ==22183== Use of uninitialised value of size 8
    ==22183==    at 0x487FD84: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Use of uninitialised value of size 8
    ==22183==    at 0x487FF94: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EDB4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EDC4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EDD4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EDE4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE78: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE04: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE14: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE24: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE34: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE44: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE54: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Conditional jump or move depends on uninitialised value(s)
    ==22183==    at 0x487EE68: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Use of uninitialised value of size 8
    ==22183==    at 0x487FEB4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Use of uninitialised value of size 8
    ==22183==    at 0x4889130: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Use of uninitialised value of size 8
    ==22183==    at 0x4889438: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    ==22183== Use of uninitialised value of size 8
    ==22183==    at 0x4889140: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
    ==22183==
    Built index with 1 access points.
    ==22183== Syscall param write(buf) points to uninitialised byte(s)
    ==22183==    at 0x495D1C8: __write_nocancel (syscall-template.S:84)
    ==22183==    by 0x490D1B7: _IO_file_write@@GLIBC_2.17 (fileops.c:1263)
    ==22183==    by 0x490C7DB: new_do_write (fileops.c:518)
    ==22183==    by 0x490E0D3: _IO_do_write@@GLIBC_2.17 (fileops.c:494)
    ==22183==    by 0x490D9F7: _IO_file_close_it@@GLIBC_2.17 (fileops.c:165)
    ==22183==    by 0x4901A2F: fclose@@GLIBC_2.17 (iofclose.c:58)
    ==22183==    by 0x403CD3: action_create_index (gztool.c:1413)
    ==22183==    by 0x404C83: main (gztool.c:1836)
    ==22183==  Address 0x4a4c059 is 2,233 bytes inside a block of size 4,096 alloc'd
    ==22183==    at 0x4844B88: malloc (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
    ==22183==
    Index written to 'TEST.gz.gzi'.

    Processing 'blank.gz.gzi.gz' ...
    Built index with 1 access points.
    Index written to 'blank.gz.gzi.gz.gzi'.

    Processing 'output_file.gz' ...
    Built index with 1 access points.
    Index written to 'output_file.gz.gzi'.

    Processing 'bgzip_project.20190530.2.tar.gz' ...
    Built index with 131 access points.
    ==22183== Syscall param write(buf) points to uninitialised byte(s)
    ==22183==    at 0x495D1C8: __write_nocancel (syscall-template.S:84)
    ==22183==    by 0x490D1B7: _IO_file_write@@GLIBC_2.17 (fileops.c:1263)
    ==22183==    by 0x490C7DB: new_do_write (fileops.c:518)
    ==22183==    by 0x490D7F3: _IO_file_xsputn@@GLIBC_2.17 (fileops.c:1342)
    ==22183==    by 0x4902DFF: fwrite (iofwrite.c:39)
    ==22183==    by 0x402E97: serialize_index_to_file (gztool.c:1035)
    ==22183==    by 0x403C97: action_create_index (gztool.c:1409)
    ==22183==    by 0x404C83: main (gztool.c:1836)
    ==22183==  Address 0x4b72ab8 is 4,040 bytes inside a block of size 31,571 alloc'd
    ==22183==    at 0x4846F14: realloc (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
    ==22183==
    Index written to 'bgzip_project.20190530.2.tar.gz.gzi'.

    ==22183==
    ==22183== HEAP SUMMARY:
    ==22183==     in use at exit: 0 bytes in 0 blocks
    ==22183==   total heap usage: 2,095 allocs, 2,095 frees, 49,095,648 bytes allocated
    ==22183==
    ==22183== All heap blocks were freed -- no leaks are possible
    ==22183==
    ==22183== For counts of detected and suppressed errors, rerun with: -v
    ==22183== Use --track-origins=yes to see where uninitialised values come from
    ==22183== ERROR SUMMARY: 807268 errors from 21 contexts (suppressed: 0 from 0)




-------------------------------------------------------------------------------
[[RSG]] [[20190724]] 


odroid@odroid64:~/SD/dev/zlib/examples$ valgrind ./gztool -f -S bbbbb
==22427== Memcheck, a memory error detector
==22427== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
==22427== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
==22427== Command: ./gztool -f -S bbbbb
==22427==

==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x484C5A4: strstr (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
==22427==
Waiting for creation of file 'bbbbb'
Processing 'bbbbb' ...
==22427== Use of uninitialised value of size 8
==22427==    at 0x487FD84: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x487FF94: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EDB4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EDC4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EDD4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EDE4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE78: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE04: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE14: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE24: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE34: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE44: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE54: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Conditional jump or move depends on uninitialised value(s)
==22427==    at 0x487EE68: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x487FEB4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x4889130: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x4889140: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x487FEB4: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x4889130: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x4889140: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Use of uninitialised value of size 8
==22427==    at 0x4889438: ??? (in /lib/aarch64-linux-gnu/libz.so.1.2.8)
==22427==
==22427== Syscall param write(buf) points to uninitialised byte(s)
==22427==    at 0x495D1C8: __write_nocancel (syscall-template.S:84)
==22427==    by 0x490D1B7: _IO_file_write@@GLIBC_2.17 (fileops.c:1263)
==22427==    by 0x490C7DB: new_do_write (fileops.c:518)
==22427==    by 0x490E0D3: _IO_do_write@@GLIBC_2.17 (fileops.c:494)
==22427==    by 0x490C6C7: _IO_file_sync@@GLIBC_2.17 (fileops.c:874)
==22427==    by 0x4901DAF: fflush (iofflush.c:40)
==22427==    by 0x40242F: serialize_index_to_file (gztool.c:719)
==22427==    by 0x40275F: build_index (gztool.c:854)
==22427==    by 0x403CFF: action_create_index (gztool.c:1509)
==22427==    by 0x40522F: main (gztool.c:2015)
==22427==  Address 0x4a4446e is 2,222 bytes inside a block of size 4,096 alloc'd
==22427==    at 0x4844B88: malloc (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
==22427==





Index written to 'bbbbb.gzi'.
Built index with 64 access points.

==22427==
==22427== HEAP SUMMARY:
==22427==     in use at exit: 3,122 bytes in 3 blocks
==22427==   total heap usage: 981 allocs, 978 frees, 22,466,360 bytes allocated
==22427==
==22427== LEAK SUMMARY:
==22427==    definitely lost: 50 bytes in 2 blocks
==22427==    indirectly lost: 3,072 bytes in 1 blocks
==22427==      possibly lost: 0 bytes in 0 blocks
==22427==    still reachable: 0 bytes in 0 blocks
==22427==         suppressed: 0 bytes in 0 blocks
==22427== Rerun with --leak-check=full to see details of leaked memory
==22427==
==22427== For counts of detected and suppressed errors, rerun with: -v
==22427== Use --track-origins=yes to see where uninitialised values come from
==22427== ERROR SUMMARY: 148801 errors from 20 contexts (suppressed: 0 from 0)


.................................................


Resuelto: había un return en ACT_SUPERVISE, en vez de un break que permite llegar
al final de main() y hacer free() de varios recursos.


-------------------------------------------------------------------------------
[[RSG]] [[20190726]] :<#ignorar permisos de los ficheros en git> 

Es muy útil al mover el repositorio entre Windows y linux <#ignorar permisos de los ficheros en git>,
ya que si no, fallan muchos comandos porque los cambios de permisos se detectan como cambios aún
no commiteados, y un stash (ni en realidad nada) puede arreglar este warning bloqueante.

<https://stackoverflow.com/questions/1580596/how-do-i-make-git-ignore-file-mode-chmod-changes>


git config core.fileMode false



-------------------------------------------------------------------------------
[[RSG]] [[20190728]] [[TODO]] 


TODO: gztool
.................................................

build_index() 
// TODO : tail is referred to gzip contents, not to end of index (in/complete) file
    dos bloques: uno en el sleep() para extraer el último bloque descomprimido y marcar extracción a partir de entonces (-T)
    otro el del final, pasado bajo "} while (ret.error != Z_STREAM_END);" para el caso de ficheros completos, si no ha saltado el bloque anterior (-T, -t)
o
    convertir el -T y -t en (un análogo de) EXTRACT_FROM_BYTE y entonces NO HAY NINGÚN PROBLEMA YA.
    Si -t y el índice está incompleto, pasar el caso a -T: no, porque -t implica siempre solo sacar el final, no más.
    Para el único que no vale esto es si in=stdin porque no se conoce 
    de antemano (a menos que el índice esté completo) la longitud de la entrada: 
    en cuyo caso los dos anteriores son necesarios: (-T y -t son diferentes) -T puesto antes del sleep, activa -t, y -t al final fuera del bucle.
o:

INDEX_AND_EXTRACTION_OPTIONS        |  index complete   |            index incomplete           |      no index     |
                                    |                   |       stdin       |    gz file        |  stdin  | gz file |
------------------------------------+-------------------+-------------------+-------------------+---------+---------+
JUST_CREATE_INDEX                   |     last here     |               last here               |         -         | these don't
SUPERVISE_DO                        |     last here     |               last here               |         -         | extract data
------------------------------------+-------------------+-------------------+-------------------+---------+---------+
SUPERVISE_DO_AND_EXTRACT_FROM_TAIL  | last here, offset |   last here,[2]   |   last here,[1]   |   [2]   |   [1]   | these do
EXTRACT_FROM_BYTE                   |       offset*     |                offset*                |       offset*     | extract data
EXTRACT_TAIL                        | last here, offset |   last here,[4]   |   last here,[3]   |   [4]   |   [3]   |
------------------------------------+-------------------+-------------------+-------------------+---------+---------+

*: offset value comes from caller as parameter

offset: is in practice only use with indx_n_extraction_opts set to EXTRACT_FROM_BYTE
    offset (and offset_in) will be decremented until offset(_in)==0 (offset_in decremented IIF extraction_from_offset_in == 1)
    in which case uncompressed output to stdout will begin

"last here" sets actual_index_point = "here".
    TODO: this may be needed no more.

[1]: size of gzip file => offset_in (nueva variable, a chequear como offset)
[3]: size of gzip file => offset_in, extract until 
    first depletion, or 
    EOF, or 
    .in>(size of gzip file)_0

[2]: on first fread depletion, start extraction: how to mark this?: start_extraction_on_first_depletion
    ([continue_extraction = 1][correction 20190824: NO!])
[4]: on first fread depletion, extract and stop
But if no fread depletion occurs, then last strm. data (This needs window2[WINSIZE] and window2_size).


two new parameters needed:
extraction_from_offset_in = 1 when to extract inconditionally (offset<=0 sets this one): in practice marks the use of "offset_in"
start_extraction_on_first_depletion = 1 for [2] and [4]

Note that EXTRACT_FROM_BYTE 0 may have a "extraction_from_offset_in = 0"
This doesn't matter as it is not checked on EXTRACT_FROM_BYTE extraction block.

20190730: creo que he acabado de implementar las condiciones de la tabla.

TODO: falta ahora toda la parte de implementación nueva y reescritura de los fwrite(stdout...)
20190731: DONE.


20190731: ¡chequear!

20190824: "continue_extraction" name changed to "extraction_from_offset_in"

.................................................



build_index() lacks indx_n_extraction_opts management, when NULL == built (index do not exist)



odroid@odroid64:~/SD/dev/zlib/gztool$ gcc -g -O0 -o gztool gztool.c -lz; rm bbbbb.gzi; rm bbbbb; ./gztool -T bbbbb | tee /dev/stderr | wc

Waiting for creation of file 'bbbbb'
Processing 'bbbbb' ...
Index written to 'bbbbb.gzi'.
Built index with 64 access points.


      0       0 970934774


???

odroid@odroid64:~/SD/dev/zlib/gztool$ ./gztool -T

odroid@odroid64:~/SD/dev/zlib/gztool$
odroid@odroid64:~/SD/dev/zlib/gztool$
odroid@odroid64:~/SD/dev/zlib/gztool$
odroid@odroid64:~/SD/dev/zlib/gztool$ ./gztool -t

    Extracting tail data from stdin,
    using index '(null)'...
    Index file '(null)' not found.
odroid@odroid64:~/SD/dev/zlib/gztool$




.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................
.................................................




odroid@odroid64:~/SD/dev/zlib/gztool$ ./gztool -T bbbbb | wc

    Processing 'bbbbb' ...
    gztool: gztool.c:808: build_index: Assertion `index->index_incomplete == 1' failed.
          0       0       0


odroid@odroid64:~/SD/dev/zlib/gztool$ ./gztool -T bbbbb

    Processing 'bbbbb' ...
    Segmentation fault


odroid@odroid64:~/SD/dev/zlib/gztool$
odroid@odroid64:~/SD/dev/zlib/gztool$ ./gztool -T bbbbb

Processing 'bbbbb' ...
Index file is still growing!
*built = 0x41a4a0
NULL != *built
Error while reading index file. Extraction aborted.
ERROR: Read error on 'bbbbb'.


odroid@odroid64:~/SD/dev/zlib/gztool$ ls -l bbbbb*
-rw-rw-r-- 1 odroid odroid 204800 Jul 27 01:02 bbbbb
-rw-rw-r-- 1 odroid odroid      0 Jul 27 12:14 bbbbb.gzi



if `-T` but gzip file is finished, nothing is printed,
because print block is at the beginning of the do{} loop.



2. strm.next_out = 0x7ff84bb258 ???
2. 32768 ???
0. strm.next_out = 0x7ff84b3258 ???
Index written to 'bbbbb.gzi'.
Built index with 64 access points.


      0       0 970934774



2. strm.next_out = 0x7ff58d95a8 ???
2. 32768 ???
0. strm.next_out = 0x7ff58d15a8 ???
Index written to 'bbbbb.gzi'.
Built index with 64 access points.


      0       0 970914626







-------------------------------------------------------------------------------
[[RSG]] [[20190808]] [[20190815]] 


gcc -static -O3 -I.. -o gztool gztool.c libz.a

.................................................

gcc -O3 -o gztool gztool.c -lz

zip gztool.zip -r . -x bgzip_project.20190530.2.tar.gz* -x bitcoin* -x T*

.................................................
20190815:

gcc -static -O3 -I.. -o gztool gztool.c libz.a -lm

.................................................

gcc -O3 -o gztool gztool.c -lz -lm

gcc -g -O0 -o gztool gztool.c -lz -lm


-------------------------------------------------------------------------------
[[RSG]] [[20190809]] 

En versiones anteriores el primer bloque creo que no estaba limpio y contenía zonas de memoria no inicializadas (sospecho):

odroid@odroid64:~/SD/dev/zlib/gztool$ dd if=bgzip_project.20190530.2.tar.gz.gzi of=chunk.gz skip=56 bs=1 count=1465
odroid@odroid64:~/SD/dev/zlib/gztool$ gztool -d chunk.gz > chunk

Nótese el 
++++++++++++++++++++++++
P   r   o   c   e   s   s   i
0054520   n   g       '   b   g   z   i   p   _   p   r   o   j   e   c
0054540   t   .   2   0   1   9   0   5   3   0   .   2   .   t   a   r
0054560   .   g   z   '
++++++++++++++++++++++++
que no puede formar parte del propio bgzip_project.20190530.2.tar.gz ...

odroid@odroid64:~/SD/dev/zlib/gztool$ od -c chunk
0000000  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0050720  \0  \0  \0  \0  \0  \0  \0  \0 300 031   j 333 177  \0  \0  \0
0050740   8 213 352 246 177  \0  \0  \0 026   U   @  \0  \0  \0  \0  \0
0050760 330 377 377 377  \0  \0  \0  \0 260   ^ 367 246 177  \0  \0  \0
0051000 377 377 377 377  \0  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0051020  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0051060  \0  \0  \0  \0  \0  \0  \0  \0   ` 037   j 333 177  \0  \0  \0
0051100 350 246 352 246 177  \0  \0  \0 250   c 372 246 177  \0  \0  \0
0051120 377 377 377 377  \0  \0  \0  \0 240   F   j 333 177  \0  \0  \0
0051140  \0  \0  \0  \0  \0  \0  \0  \0  \b   U   @  \0  \0  \0  \0  \0
0051160 250   c 372 246 177  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0051200 360   V 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051220  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051240 220 037   j 333 177  \0  \0  \0 024   U   @  \0  \0  \0  \0  \0
0051260  \0  \0  \0  \0  \0  \0  \0  \0  \b   U   @  \0  \0  \0  \0  \0
0051300   h   a 367 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051320  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051340      \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051360      \0  \0  \0  \0  \0  \0  \0 360   V 001 247 177  \0  \0  \0
0051400  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051420 377 377 377 377 377 377 377 377 001  \0  \0  \0  \0  \0  \0  \0
0051440  \0  \0  \0  \0  \0  \0  \0  \0   `   G   j 333 177  \0  \0  \0
0051460   T 242 352 246 177  \0  \0  \0  \0  \0  \0  \0 200 377 377 377
0051500 220   G   j 333 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051520  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0051560 034   U   @  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0051600  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0051660 220   G   j 333 177  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0051700   `   G   j 333 177  \0  \0  \0 320 377 377 377 200 377 377 377
0051720  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0053460  \0  \0  \0  \0  \0  \0  \0  \0 360 036   j 333 177  \0  \0  \0
0053500 334 327 354 246 177  \0  \0  \0 250   c 372 246 177  \0  \0  \0
0053520   1  \0  \0  \0  \0  \0  \0  \0 320       j 333 177  \0  \0  \0
0053540 320       j 333 177  \0  \0  \0     037   j 333 177  \0  \0  \0
0053560 364 347 354 246 177  \0  \0  \0   1  \0  \0  \0  \0  \0  \0  \0
0053600 250   c 372 246 177  \0  \0  \0   1  \0  \0  \0  \0  \0  \0  \0
0053620  \0  \0  \0  \0  \0  \0  \0  \0   ` 037   j 333 177  \0  \0  \0
0053640   | 247 352 246 177  \0  \0  \0 250   c 372 246 177  \0  \0  \0
0053660   1  \0  \0  \0  \0  \0  \0  \0   1  \0  \0  \0  \0  \0  \0  \0
0053700  \0  \0  \0  \0  \0  \0  \0  \0  \b   U   @  \0  \0  \0  \0  \0
0053720 250   c 372 246 177  \0  \0  \0 360   @   j 333 177  \0  \0  \0
0053740   , 207 352 246 177  \0  \0  \0 207   ( 255 373  \0  \0  \0  \0
0053760      \0  \0  \0  \0  \0  \0  \0 240   F   j 333 177  \0  \0  \0
0054000  \0  \0  \0  \0  \0  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0054020 220   G   j 333 177  \0  \0  \0   `   G   j 333 177  \0  \0  \0
0054040 320 377 377 377 200 377 377 377  \0  \0  \0  \0  \0  \0  \0  \0
0054060   @  \v 354 246 177  \0  \0  \0 250   c 372 246 177  \0  \0  \0
0054100  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0054120 004 200 255 373  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0054140  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0054160 320       j 333 177  \0  \0  \0 001   !   j 333 177  \0  \0  \0
0054200 320   @   j 333 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0054220  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0054420 377 377 377 377  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0054440  \0  \0  \0  \0  \0  \0  \0  \0   0   > 372 246 177  \0  \0  \0
0054460 250   c 372 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0054500  \0  \0  \0  \0  \0  \0  \0  \0   P   r   o   c   e   s   s   i
0054520   n   g       '   b   g   z   i   p   _   p   r   o   j   e   c
0054540   t   .   2   0   1   9   0   5   3   0   .   2   .   t   a   r
0054560   .   g   z   '       .   .   .  \n  \0  \0  \0  \0  \0  \0  \0
0054600  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0070040  \0  \0  \0  \0  \0  \0  \0  \0 340   9   j 333 177  \0  \0  \0
0070060 344   B 377 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0070100  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0070160  \0 340 022  \0  \0  \0  \0  \0 034 326 022  \0  \0  \0  \0  \0
0070200 034 326 022  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0070220 005  \0  \0  \0  \0  \0  \0  \0  \0 320 023  \0  \0  \0  \0  \0
0070240  \0   0 024  \0  \0  \0  \0  \0 210   % 024  \0  \0  \0  \0  \0
0070260 230   b 024  \0  \0  \0  \0  \0  \0 320 022  \0  \0  \0  \0  \0
0070300 003  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0070320  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0070540  \0   ` 001  \0  \0  \0  \0  \0   t   \ 001  \0  \0  \0  \0  \0
0070560   t   \ 001  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0070600 005  \0  \0  \0  \0  \0  \0  \0   @   9   j 333 177  \0  \0  \0
0070620 270 223 377 246 177  \0  \0  \0   P 212 001 247 177  \0  \0  \0
0070640   H 324 001 247 177  \0  \0  \0   !  \0  \0  \0  \0  \0  \0  \0
0070660 003  \0  \0  \0  \0  \0  \0  \0 340   9   j 333 177  \0  \0  \0
0070700 344   > 377 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0070720 003  \0  \0  \0  \0  \0  \0  \0  \0 260 001 247 177  \0  \0  \0
0070740   \  \t   @  \0  \0  \0  \0  \0 340   9   j 333 177  \0  \0  \0
0070760 274   F 377 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071000 003  \0  \0  \0  \0  \0  \0  \0 300 274 001 247 177  \0  \0  \0
0071020   \  \t   @  \0  \0  \0  \0  \0  \v 342  \0  \0  \0  \0  \0  \0
0071040 274   F 377 246 001  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071060 003  \0  \0  \0  \0  \0  \0  \0 360   9   j 333 177  \0  \0  \0
0071100 210   i 377 246 177  \0  \0  \0   r 241 347 246 177  \0  \0  \0
0071120  \0  \0  \0  \0  \0  \0  \0  \0   `   ;   j 333 177  \0  \0  \0
0071140   $   k 377 246 177  \0  \0  \0 020   >   j 333 177  \0  \0  \0
0071160 370 247 377 246 177  \0  \0  \0 270   B   j 333 177  \0  \0  \0
0071200   r 241 347 246 177  \0  \0  \0 230   K 372 246 177  \0  \0  \0
0071220   P 212 001 247 177  \0  \0  \0  \0 200  \0 247 177  \0  \0  \0
0071240   P 320 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071260 360   ?   j 333 177  \0  \0  \0 020   I 347 246 177  \0  \0  \0
0071300   0   A   j 333 177  \0  \0  \0   P 375 376 246 177  \0  \0  \0
0071320   @   <   j 333 177  \0  \0  \0 230 242 372 246 177  \0  \0  \0
0071340       8   j 333 177  \0  \0  \0 260   9   j 333 177  \0  \0  \0
0071360   $   k 377 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071400 003  \0  \0  \0  \0  \0  \0  \0   @   <   j 333 177  \0  \0  \0
0071420       8   j 333 177  \0  \0  \0 230   b 024  \0  \0  \0  \0  \0
0071440 006  \0  \0  \0  \0  \0  \0  \0   h 321 001 247 177  \0  \0  \0
0071460   ( 212 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071500   '   <   j 333 177  \0  \0  \0 002 263  \0  \0  \0  \0  \0  \0
0071520  \v 342  \0  \0  \0  \0  \0  \0 355 201  \0  \0 001  \0  \0  \0
0071540  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071560  \0  \0  \0  \0  \0  \0  \0  \0   0   ;   j 333 177  \0  \0  \0
0071600 210   i 377 246 177  \0  \0  \0 177  \n   @  \0  \0  \0  \0  \0
0071620  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071640   I   @   D   Y  \0  \0  \0  \0   P   ?   j 333 177  \0  \0  \0
0071660 370 247 377 246 177  \0  \0  \0 270   B   j 333 177  \0  \0  \0
0071700 177  \n   @  \0  \0  \0  \0  \0  \b   n   A  \0  \0  \0  \0  \0
0071720 220 321 001 247 177  \0  \0  \0  \0 200  \0 247 177  \0  \0  \0
0071740   P 320 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0071760  \0  \0  \0  \0  \0  \0  \0  \0 210  \b   @  \0  \0  \0  \0  \0
0072000 220   A   j 333 177  \0  \0  \0  \0 200  \0 247 177  \0  \0  \0
0072020   P 320 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0072040  \0  \0  \0  \0  \0  \0  \0  \0 210  \b   @  \0  \0  \0  \0  \0
0072060 220   A   j 333 177  \0  \0  \0  \0 200  \0 247 177  \0  \0  \0
0072100  \0  \0  \0  \0  \0  \0  \0  \0   x 213  \0 247 177  \0  \0  \0
0072120  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0072140 001  \0  \0  \0 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0072160 220 321 001 247 177  \0  \0  \0  \n  \0  \0  \0  \0  \0  \0  \0
0072200  \0 260 001 247 177  \0  \0  \0   ( 212 001 247 177  \0  \0  \0
0072220 001  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0072240   ( 212 001 247 177  \0  \0  \0 260   I   j 333 177  \0  \0  \0
0072260   @ 003  \0  \0  \0  \0  \0  \0 177   E   L   F 002 001 001  \0
0072300  \0  \0  \0  \0  \0  \0  \0  \0 003  \0 267  \0 001  \0  \0  \0
0072320 350 371 001  \0  \0  \0  \0  \0   @  \0  \0  \0  \0  \0  \0  \0
0072340   H   > 023  \0  \0  \0  \0  \0  \0  \0  \0  \0   @  \0   8  \0
0072360  \n  \0   @  \0   L  \0   K  \0 006  \0  \0  \0 005  \0  \0  \0
0072400   @  \0  \0  \0  \0  \0  \0  \0   @  \0  \0  \0  \0  \0  \0  \0
0072420   @  \0  \0  \0  \0  \0  \0  \0   0 002  \0  \0  \0  \0  \0  \0
0072440   0 002  \0  \0  \0  \0  \0  \0  \b  \0  \0  \0  \0  \0  \0  \0
0072460 003  \0  \0  \0 004  \0  \0  \0 250 346 021  \0  \0  \0  \0  \0
0072500 250 346 021  \0  \0  \0  \0  \0 250 346 021  \0  \0  \0  \0  \0
0072520 033  \0  \0  \0  \0  \0  \0  \0 033  \0  \0  \0  \0  \0  \0  \0
0072540  \b  \0  \0  \0  \0  \0  \0  \0 001  \0  \0  \0 005  \0  \0  \0
0072560  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0072600  \0  \0  \0  \0  \0  \0  \0  \0 034 326 022  \0  \0  \0  \0  \0
0072620 034 326 022  \0  \0  \0  \0  \0  \0  \0 001  \0  \0  \0  \0  \0
0072640 001  \0  \0  \0 006  \0  \0  \0 220 334 022  \0  \0  \0  \0  \0
0072660 220 334 023  \0  \0  \0  \0  \0 220 334 023  \0  \0  \0  \0  \0
0072700 370   H  \0  \0  \0  \0  \0  \0  \b 206  \0  \0  \0  \0  \0  \0
0072720  \0  \0 001  \0  \0  \0  \0  \0 002  \0  \0  \0 006  \0  \0  \0
0072740 230  \v 023  \0  \0  \0  \0  \0 230  \v 024  \0  \0  \0  \0  \0
0072760 230  \v 024  \0  \0  \0  \0  \0 260 001  \0  \0  \0  \0  \0  \0
0073000 260 001  \0  \0  \0  \0  \0  \0  \b  \0  \0  \0  \0  \0  \0  \0
0073020 004  \0  \0  \0 004  \0  \0  \0   p 002  \0  \0  \0  \0  \0  \0
0073040   p 002  \0  \0  \0  \0  \0  \0   p 002  \0  \0  \0  \0  \0  \0
0073060   D  \0  \0  \0  \0  \0  \0  \0   D  \0  \0  \0  \0  \0  \0  \0
0073100 004  \0  \0  \0  \0  \0  \0  \0  \a  \0  \0  \0 004  \0  \0  \0
0073120 220 334 022  \0  \0  \0  \0  \0 220 334 023  \0  \0  \0  \0  \0
0073140 220 334 023  \0  \0  \0  \0  \0 020  \0  \0  \0  \0  \0  \0  \0
0073160   x  \0  \0  \0  \0  \0  \0  \0  \b  \0  \0  \0  \0  \0  \0  \0
0073200   P 345   t   d 004  \0  \0  \0   0   >   j 333 177  \0  \0  \0
0073220 260 311 377 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0073240   | 032  \0  \0  \0  \0  \0  \0 320   A   j 333 177  \0  \0  \0
0073260 220 251 377 246 177  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0073300  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0073320 270   B   j 333 177  \0  \0  \0 300 247 377 246 177  \0  \0  \0
0073340 247   B   j 333 177  \0  \0  \0 250   B   j 333 177  \0  \0  \0
0073360 260   B   j 333 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0073400   0 320 001 247 177  \0  \0  \0 220 334 023  \0  \0  \0  \0  \0
0073420 260   B   j 333 177  \0  \0  \0 250   B   j 333 177  \0  \0  \0
0073440 247   B   j 333 177  \0  \0  \0 224   >   j 333 177  \0  \0  \0
0073460 001  \0  \0  \0  \0  \0  \0  \0   r 241 347 246 177  \0  \0  \0
0073500 230   K 372 246 177  \0  \0  \0   P 212 001 247 177  \0  \0  \0
0073520  \0 200  \0 247 177  \0  \0  \0   P 320 001 247 177  \0  \0  \0
0073540  \0  \0  \0  \0  \0  \0  \0  \0 360   ?   j 333 177  \0  \0  \0
0073560 020   I 347 246 177  \0  \0  \0   0   A   j 333 177  \0  \0  \0
0073600   0   >   j 333 177  \0  \0  \0 240 311 377 246 177  \0  \0  \0
0073620 304  \0  \b  \0 005 204  \0   `   0   >   j 333 177  \0  \0  \0
0073640  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0073700  \0  \0  \0  \0  \0  \0  \0  \0 260   ?   j 333 177  \0  \0  \0
0073720 320   x 377 246 177  \0  \0  \0 207 360 226   |  \0  \0  \0  \0
0073740   y  \b  \0  \0  \0  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0073760 230   @   j 333 177  \0  \0  \0   L   | 346 246 177  \0  \0  \0
0074000 032  \n   @  \0  \0  \0  \0  \0   P 212 001 247 177  \0  \0  \0
0074020 230   @   j 333 177  \0  \0  \0  \0   @   j 333 177  \0  \0  \0
0074040   8 213 352 246 177  \0  \0  \0   :   _   @  \0  \0  \0  \0  \0
0074060 330 377 377 377  \0  \0  \0  \0 260   ^ 367 246 177  \0  \0  \0
0074100 377 377 377 377  \0  \0  \0  \0 340   G   j 333 177  \0  \0  \0
0074120 347 367 376 246 177  \0  \0  \0   H   c 001 247 177  \0  \0  \0
0074140 001  \0  \0  \0  \0  \0  \0  \0   P 312 001 247 177  \0  \0  \0
0074160   P   A   j 333 177  \0  \0  \0 240   E   j 333 177  \0  \0  \0
0074200   |   X 354 246 177  \0  \0  \0 360   E   j 333 177  \0  \0  \0
0074220 360   F   j 333 177  \0  \0  \0   8   _   @  \0  \0  \0  \0  \0
0074240 020 200   A  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0074260  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0074320  \0  \0  \0  \0  \0  \0  \0  \0 020   I 347 246 177  \0  \0  \0
0074340 320   E   j 333 177  \0  \0  \0   8   _   @  \0  \0  \0  \0  \0
0074360  \0  \0  \0  \0  \0  \0  \0  \0   8   _   @  \0  \0  \0  \0  \0
0074400   h   a 367 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0074420  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0074440      \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0074460      \0  \0  \0  \0  \0  \0  \0 360   V 001 247 177  \0  \0  \0
0074500  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0074520 377 377 377 377 377 377 377 377 001  \0  \0  \0  \0  \0  \0  \0
0074540  \0  \0  \0  \0  \0  \0  \0  \0 220   F   j 333 177  \0  \0  \0
0074560 210 362 352 246 177  \0  \0  \0 355   Q   j 333 177  \0  \0  \0
0074600  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0074700  \0  \0  \0  \0  \0  \0  \0  \0 377 377 377 377  \0  \0  \0  \0
0074720  \0   p  \0 247 177  \0  \0  \0 330   G 347 246 177  \0  \0  \0
0074740   P 212 001 247 177  \0  \0  \0 240   A   j 333 177  \0  \0  \0
0074760 340   G   j 333 177  \0  \0  \0 340   G   j 333 177  \0  \0  \0
0075000 260   G   j 333 177  \0  \0  \0 320 377 377 377 200 377 377 377
0075020  \0  \0  \0  \0  \0  \0  \0  \0 300   A   j 333 177  \0  \0  \0
0075040   8 235 377 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0075060  \0  \0  \0  \0  \0  \0  \0  \0 340   B   j 333 177  \0  \0  \0
0075100 004   ' 377 246 177  \0  \0  \0 220 321 001 247 177  \0  \0  \0
0075120  \0 260 001 247 177  \0  \0  \0   `   G   j 333 177  \0  \0  \0
0075140 320 377 377 377 177  \0  \0  \0  \0  \0  \0  \0 200 377 377 377
0075160 220   G   j 333 177  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0075200 220   G   j 333 177  \0  \0  \0   `   G   j 333 177  \0  \0  \0
0075220 320 377 377 377 200 377 377 377 270   j  \0 247 177  \0  \0  \0
0075240  \0 300 001 247 177  \0  \0  \0 200   5  \0 247 177  \0  \0  \0
0075260   d   5  \0 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0075300 340   B   j 333 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0075320 340   B   j 333 177  \0  \0  \0 230   B   j 333 177  \0  \0  \0
0075340   h 366 376 246 177  \0  \0  \0 002 004  \0  \0 177  \0  \0  \0
0075360   ( 300 001 247 177  \0  \0  \0 350 324 001 247 177  \0  \0  \0
0075400 310 372 376 246 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0075420 330   G 347 246 177  \0  \0  \0 270 370 376 246 177  \0  \0  \0
0075440 020 002  \0  \0  \0  \0  \0  \0  \r  \0  \0  \0  \0  \0  \0  \0
0075460  \0  \0  \0  \0 177  \0  \0  \0 340   B   j 333 177  \0  \0  \0
0075500   4   ' 377 246 177  \0  \0  \0   h 321 001 247 177  \0  \0  \0
0075520  \0  \0  \0  \0 177  \0  \0  \0 020   D   j 333 177  \0  \0  \0
0075540 030   ;  \0 247 177  \0  \0  \0   ( 276 001 247 177  \0  \0  \0
0075560  \b  \f 377 246 177  \0  \0  \0 300 274 001 247 177  \0  \0  \0
0075600  \b  \0  \0  \0  \0  \0  \0  \0   @  \0   @  \0  \0  \0  \0  \0
0075620 300 274 001 247 177  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0075640 001  \0  \0  \0  \0  \0  \0  \0 220   C   j 333 177  \0  \0  \0
0075660 320   x 377 246 177  \0  \0  \0   U 251 245   B  \0  \0  \0  \0
0075700 016  \0  \0  \0  \0  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0075720   x   D   j 333 177  \0  \0  \0   X 363 376 246 177  \0  \0  \0
0075740 267   ` 347 246 177  \0  \0  \0   P 312 001 247 177  \0  \0  \0
0075760   x   D   j 333 177  \0  \0  \0   t   D   j 333 177  \0  \0  \0
0076000  \0  \0  \0  \0  \0  \0  \0  \0 240   D   j 333 177  \0  \0  \0
0076020 254 201 377 246 177  \0  \0  \0   U 251 245   B  \0  \0  \0  \0
0076040 250 215 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0076060 267   ` 347 246 177  \0  \0  \0 350   b 001 247 177  \0  \0  \0
0076100 001  \0  \0  \0  \0  \0  \0  \0   0   D   j 333 177  \0  \0  \0
0076120 320   x 377 246 177  \0  \0  \0   = 255   9  \r  \0  \0  \0  \0
0076140 200 004  \0  \0  \0  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0076160 030   E   j 333 177  \0  \0  \0   `   D   j 333 177  \0  \0  \0
0076200 320   x 377 246 177  \0  \0  \0   > 371 377 274  \0  \0  \0  \0
0076220 233 006  \0  \0  \0  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0076240   H   E   j 333 177  \0  \0  \0 324   t 346 246 177  \0  \0  \0
0076260 021  \0  \0  \0  \0  \0  \0  \0   P 212 001 247 177  \0  \0  \0
0076300   H   E   j 333 177  \0  \0  \0   D   E   j 333 177  \0  \0  \0
0076320 221 215 347 246 177  \0  \0  \0   p   E   j 333 177  \0  \0  \0
0076340 254 201 377 246 177  \0  \0  \0   > 371 377 274  \0  \0  \0  \0
0076360 350 324 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0076400   5  \n   @  \0  \0  \0  \0  \0   0   ` 001 247 177  \0  \0  \0
0076420 001  \0  \0  \0  \0  \0  \0  \0 220 321 001 247 177  \0  \0  \0
0076440  \0   F   j 333 177  \0  \0  \0 250   F   j 333 177  \0  \0  \0
0076460 020   F   j 333 177  \0  \0  \0 030   E   j 333 177  \0  \0  \0
0076500 004  \0  \0  \0  \0  \0  \0  \0 002  \0  \0  \0  \0  \0  \0  \0
0076520  \0  \0  \0  \0 177  \0  \0  \0 230 217 001 247 177  \0  \0  \0
0076540  \0   F   j 333 177  \0  \0  \0   H   E   j 333 177  \0  \0  \0
0076560   D   E   j 333 177  \0  \0  \0   p 005   @  \0  \0  \0  \0  \0
0076600   0   ` 001 247 177  \0  \0  \0 020   I 347 246 177  \0  \0  \0
0076620   5  \n   @  \0  \0  \0  \0  \0 020   F   j 333 177  \0  \0  \0
0076640 344 377 363 002  \0  \0  \0  \0 200   | 346 246 177  \0  \0  \0
0076660  \0 260 001 247 177  \0  \0  \0   @   F   j 333  \0  \0  \0  \0
0076700  \0  \0  \0  \0  \0  \0  \0  \0 001  \0  \0  \0 177  \0  \0  \0
*
0076740 220 321 001 247 177  \0  \0  \0   p   F   j 333 177  \0  \0  \0
0076760 300 276 377 246 177  \0  \0  \0  \0   P 001 247 177  \0  \0  \0
0077000   (   q   A  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0077020  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
*
0077100  \0  \0  \0  \0  \0  \0  \0  \0 320   F   j 333 177  \0  \0  \0
0077120   ` 353 354 246 177  \0  \0  \0   @ 200   A  \0  \0  \0  \0  \0
0077140 350 324 001 247 177  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0077160 020 200   A  \0 001  \0  \0  \0 377 377 377 377  \0  \0  \0  \0
0077200 020 200   A  \0  \0  \0  \0  \0  \b 033 347 246 177  \0  \0  \0
0077220   P 212 001 247 177  \0  \0  \0   %   %   %   %   %   %   %   %
0077240   %   %   %   %   %   %   %   %  \0  \0  \0  \0  \0  \0  \0  \0
0077260   .   g   z  \0  \0  \0  \0  \0   %   s   i  \0  \0  \0  \0  \0
0077300   %   s   .   g   z   i  \0  \0 377 377 377 377 377 377 377 377
0077320  \0  \0  \0 377 377 377 377 377  \0  \0  \0 377 377 377 377 377
0077340  \0  \0  \0  \0  \0  \0 377 377 220   G   j 333 177  \0  \0  \0
0077360   l   '  \0 247 177  \0  \0  \0 355   Q   j 333 177  \0  \0  \0
0077400  \0  \0  \0  \0  \0  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0077420   X   ;   @  \0  \0  \0  \0  \0 220   G   j 333 177  \0  \0  \0
0077440 220   G   j 333 177  \0  \0  \0   `   G   j 333 177  \0  \0  \0
0077460 320 377 377 377 200 377 377 377 220   G   j 333 177  \0  \0  \0
0077500 220   G   j 333 177  \0  \0  \0   `   G   j 333 177  \0  \0  \0
0077520 320 377 377 377 200 377 377 377   %   %   %   %   %   %   %   %
0077540   %   %   %   %   %   %   %   %  \0  \0  \0  \0  \0  \0  \0  \0
0077560   .   g   z  \0  \0  \0  \0  \0   %   s   i  \0  \0  \0  \0  \0
0077600   %   s   .   g   z   i  \0  \0 377 377 377 377 377 377 377 377
0077620  \0  \0  \0 377 377 377 377 377  \0  \0  \0 377 377 377 377 377
0077640  \0  \0  \0  \0  \0  \0 377 377 001 004 020   @ 001 004 020   @
0077660  \0  \0  \0   @ 001 004 020   @ 001  \0  \0   @ 001 004 020   @
0077700 001  \0  \0  \0  \0  \0 020   @ 001 004 020   @ 001 004 020   @
0077720 001 004 020   @ 001 004 020   @ 355   Q   j 333 177  \0  \0  \0
0077740 250   c 372 246 177  \0  \0  \0 001  \0  \0  \0  \0  \0  \0  \0
0077760  \0  \0  \0  \0  \0  \0  \0  \0   r   T   @  \0  \0  \0  \0  \0
0100000


-------------------------------------------------------------------------------
[[RSG]] [[20190811]] [[tag]] [[git]] 

D:\Instalaciones\GitHub reps\gztool>git push origin :v0.3.141
To https://github.com/circulosmeos/gztool.git
 - [deleted]         v0.3.141

D:\Instalaciones\GitHub reps\gztool>git tag --delete v0.3.141
Deleted tag 'v0.3.141' (was 16ed421)

D:\Instalaciones\GitHub reps\gztool>git tag -a v0.3.141 -m "v0.3.141"


-------------------------------------------------------------------------------
[[RSG]] [[20190812]] [[valgrind]] 

odroid@odroid64:~/SD/dev/zlib/gztool$ valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes /home/odroid/SD/dev/zlib/gztool/gztool -Wb 129000000 ~/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz > /dev/null
    ==3632== Memcheck, a memory error detector
    ==3632== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
    ==3632== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
    ==3632== Command: /home/odroid/SD/dev/zlib/gztool/gztool -Wb 129000000 /home/odroid/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz
    ==3632==
    ACTION: Extract from byte

    Index file '/home/odroid/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gzi' already exists and will be used.
    (Use `-f` to force overwriting.)
    Processing '/home/odroid/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz' ...
    Index file is incomplete.
    Processing index ...
    ERROR: Compressed data error in '/home/odroid/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz'.

    Aborted.
    1 files processed with errors!

    ==3632==
    ==3632== HEAP SUMMARY:
    ==3632==     in use at exit: 32,768 bytes in 1 blocks
    ==3632==   total heap usage: 24 allocs, 23 frees, 202,518 bytes allocated
    ==3632==
    ==3632== 32,768 bytes in 1 blocks are definitely lost in loss record 1 of 1
    ==3632==    at 0x4846F14: realloc (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
    ==3632==
    ==3632== LEAK SUMMARY:
    ==3632==    definitely lost: 32,768 bytes in 1 blocks
    ==3632==    indirectly lost: 0 bytes in 0 blocks
    ==3632==      possibly lost: 0 bytes in 0 blocks
    ==3632==    still reachable: 0 bytes in 0 blocks
    ==3632==         suppressed: 0 bytes in 0 blocks
    ==3632==
    ==3632== For counts of detected and suppressed errors, rerun with: -v
    ==3632== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)



-------------------------------------------------------------------------------
[[RSG]] [[20190812]] [[gdb]] [[valgrind]] 


<http://valgrind.org/docs/manual/manual-core-adv.html#manual-core-adv.gdbserver-gdb> 


odroid@odroid64:~/SD/dev/zlib/gztool$ valgrind --vgdb=yes --vgdb-error=0  /home/odroid/SD/dev/zlib/gztool/gztool -Wb 129000000 ~/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz > /dev/null
    ==6352== Memcheck, a memory error detector
    ==6352== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
    ==6352== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
    ==6352== Command: /home/odroid/SD/dev/zlib/gztool/gztool -Wb 129000000 /home/odroid/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz
    ==6352==
    ==6352== (action at startup) vgdb me ...
    ==6352==
    ==6352== TO DEBUG THIS PROCESS USING GDB: start GDB like this
    ==6352==   /path/to/gdb /home/odroid/SD/dev/zlib/gztool/gztool
    ==6352== and then give GDB the following command
    ==6352==   target remote | /usr/lib/valgrind/../../bin/vgdb --pid=6352
    ==6352== --pid is optional if only one valgrind process is running
    ==6352==


.................................................

odroid@odroid64:~/SD/dev/zlib/gztool$ gdb ./gztool
    GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1
    Copyright (C) 2016 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
    and "show warranty" for details.
    This GDB was configured as "aarch64-linux-gnu".
    Type "show configuration" for configuration details.
    For bug reporting instructions, please see:
    <http://www.gnu.org/software/gdb/bugs/>.
    Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.
    For help, type "help".
    Type "apropos word" to search for commands related to "word"...
    Reading symbols from ./gztool...done.
    (gdb) set params -Wb 129000000 ~/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz
    No symbol "params" in current context.
    (gdb) set args -Wb 129000000 ~/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gz
    (gdb) target remote | vgdb
    Remote debugging using | vgdb
    relaying data between gdb and process 6352
    warning: remote target does not support file transfer, attempting to access files from local filesystem.
    Reading symbols from /lib/ld-linux-aarch64.so.1...Reading symbols from /usr/lib/debug//lib/aarch64-linux-gnu/ld-2.23.so...done.
    done.
    0x0000000004000cc0 in _start () from /lib/ld-linux-aarch64.so.1
    (gdb) monitor leak_check full reachable any
    ==6352== All heap blocks were freed -- no leaks are possible
    ==6352==
    (gdb) b 1745
    Breakpoint 1 at 0x40477c: file gztool.c, line 1745.
    (gdb) continue
    Continuing.

    Breakpoint 1, deserialize_index_from_file (input_file=0x49ea340, load_windows=0,
        file_name=0x49ea040 "/home/odroid/PROYECTOS/bitcoin/bitcoin-lottery.201908050837.gzi") at gztool.c:1745
    1745    struct access *deserialize_index_from_file( FILE *input_file, int load_windows, unsigned char *file_name ) {
    (gdb) monitor leak_check full reachable any
    ==6352== 1,171 bytes in 3 blocks are still reachable in loss record 1 of 1
    ==6352==    at 0x4844B88: malloc (in /usr/lib/valgrind/vgpreload_memcheck-arm64-linux.so)
    ==6352==
    ==6352== LEAK SUMMARY:
    ==6352==    definitely lost: 0 bytes in 0 blocks
    ==6352==    indirectly lost: 0 bytes in 0 blocks
    ==6352==      possibly lost: 0 bytes in 0 blocks
    ==6352==    still reachable: 1,171 bytes in 3 blocks
    ==6352==         suppressed: 0 bytes in 0 blocks
    ==6352==
    (gdb) n
    1747        struct access *index = NULL;
    (gdb) n
    1749        uint32_t index_complete = 1;

...


-------------------------------------------------------------------------------
[[RSG]] [[20190816]] [[20190817]] <#conversión para inflate() de bgzips>


odroid@odroid64:~/SD/dev/zlib/gztool2$ ./bgzip_test
    decompressing ...
    strm.avail_in = 16384 (i=0) (stream_size=16384)
            inflate == 0
    avail_out = 0, avail_in = 10731, next_in = 0x41cb75 (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 6968, next_in = 0x41da28 (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 3537, next_in = 0x41e78f (have=16384)
            inflate == 1
    avail_out = 256, avail_in = 233, next_in = 0x41f477 (have=16128)
    ret = 1
    output_size = 65280
    strm restarted
    strm.avail_in = 10240 (i=16151) (stream_size=10240)
            inflate == 0
    avail_out = 0, avail_in = 6013, next_in = 0x41c5e3 (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 2193, next_in = 0x41d4cf (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 183, next_in = 0x41dca9 (have=16384)
            inflate == 1
    avail_out = 15634, avail_in = 28, next_in = 0x41dd44 (have=750)
    ret = 1
    output_size = 115182
    decompressed size = 115182 (0x42f5a0)


    Without "if (ret == Z_STREAM_END)" break:
        odroid@odroid64:~/SD/dev/zlib/gztool2$ ./bgzip_test2
            decompressing ...
            strm.avail_in = 16384 (i=0) (stream_size=16384)
                    inflate == 0
            avail_out = 16384, avail_in = 16366, next_in = 0x41b572 (have=0)
            ret = 0
            output_size = 0
            strm.avail_in = 26373 (i=18) (stream_size=26373)
                    inflate == 0
            avail_out = 16384, avail_in = 26355, next_in = 0x41b572 (have=0)
            ret = 0
            output_size = 0
            *** Error in `./bgzip_test2': free(): invalid next size (normal): 0x000000000041b560 ***
            Aborted


odroid@odroid64:~/SD/dev/zlib/gztool2$ ./bgzip_test2
    decompressing ...
    strm.avail_in = 16384 (i=0) (stream_size=16384)
            inflate == 0
    avail_out = 16384, avail_in = 16366, next_in = 0x41b572 (have=0)
            inflate == 0
    avail_out = 0, avail_in = 10731, next_in = 0x41cb75 (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 6968, next_in = 0x41da28 (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 3537, next_in = 0x41e78f (have=16384)
            inflate == 0
    avail_out = 256, avail_in = 241, next_in = 0x41f46f (have=16128)
            inflate == 1
    ret = 1
    output_size = 65280
    strm restarted
    strm.avail_in = 10240 (i=16151) (stream_size=10240)
            inflate == 0
    avail_out = 16384, avail_in = 10222, next_in = 0x41b572 (have=0)
            inflate == 0
    avail_out = 0, avail_in = 6013, next_in = 0x41c5e3 (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 2193, next_in = 0x41d4cf (have=16384)
            inflate == 0
    avail_out = 0, avail_in = 183, next_in = 0x41dca9 (have=16384)
            inflate == 0
    avail_out = 15634, avail_in = 36, next_in = 0x41dd3c (have=750)
            inflate == 1
    ret = 1
    output_size = 115182
    decompressed size = 115182 (0x42f5a0)


.................................................
:<#conversión para inflate() de bgzips> :

NO se asegura ahora que strm.aval_in sea siempre cero al inicio del bucle:
así que el fread debe modificarse con una variable stream_size

Se debe copiar el contenido disponible remanente de strm.next_in al principio
de strm.next_in, y el fread debe ir a continuación.

Una vez hecho todo esto, se debe reiniciar el estado de strm con "47",
y poner al final el valor correcto de strm.avail_in = stream_size



-------------------------------------------------------------------------------
[[RSG]] [[20190817]] [[git]] [[merge]] [[tail_n_supervise]]  


odroid@odroid64:~/SD/dev/zlib/gztool$ git checkout master
Switched to branch 'master'
odroid@odroid64:~/SD/dev/zlib/gztool$ git branch
* master
  supervise
  tail_n_supervise
odroid@odroid64:~/SD/dev/zlib/gztool$ git merge tail_n_supervise
Updating d2102bf..ee09917
Fast-forward
 "bit\303\241cora - gztool.txt" | 1163 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 gztool.c                       | 1872 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-------------------------------
 2 files changed, 2438 insertions(+), 597 deletions(-)
 create mode 100644 "bit\303\241cora - gztool.txt"


-------------------------------------------------------------------------------
[[RSG]] [[20190817]] [[git]] [[bgzip_compatible]] 

odroid@odroid64:~/SD/dev/zlib/gztool$ git checkout -b bgzip_compatible
Switched to a new branch 'bgzip_compatible'

.................................................

odroid@odroid64:~/SD/dev/zlib/gztool$ diff test.CLEAR ../gztool2/gztool.c
1587,1588c1587,1589
<             printToStderr( VERBOSITY_MANIAC, "\t(%p, %d, %ld, %ld, %d, %ld)\n", index, here.bits, here.in, here.out, h�BC�'�}�wG������5�@�m�Ι�����ۄL#����A�֨[6f���zvW?$L��3}f�܏�[�nݺ�
ISE_DO_AND_EXTRACT_FROM 1 );��$\,Z����ǧ�g�z�?==�����<g�DL�,�dOD��&�'j\lm�[�/��I�}|x'��9��.Gi��eg"K�<����q`Q��<I�,J�A�
---
>             printToStderr( VERBOSITY_MANIAC, "\t(%p, %d, %ld, %ld, %d, %ld)\n", index, here.bits, here.in, here.out, here.window_size, file_size );
>             printToStderr( VERBOSITY_EXCESSIVE, "Unexpected data found in index file '%s' @%ld.\nIgnoring data subsequent to point %ld.\n",
>                     file_name, position_at_file, index_size - number_of_index_points + 1 );



-------------------------------------------------------------------------------
[[RSG]] [[20190817]] [[reword]] [[git]] [[commit]] :<#rehacer el texto de un commit anterior> 


    <https://help.github.com/en/articles/changing-a-commit-message> 
++++++++++++++++++++++++
Amending the message of older or multiple commit messages

If you need to amend the message for multiple commits or an older commit, you can use interactive rebase, then force push to change the commit history.

    On the command line, navigate to the repository that contains the commit you want to amend.

    Use the git rebase -i HEAD~n command to display a list of the last n commits in your default text editor.

    $ git rebase -i HEAD~3 # Displays a list of the last 3 commits on the current branch

    The list will look similar to the following:

    pick e499d89 Delete CNAME
    pick 0c39034 Better README
    pick f7fde4a Change the commit message but push the same commit.

    # Rebase 9fdb3bd..f7fde4a onto 9fdb3bd
    #
    # Commands:
    # p, pick = use commit
    # r, reword = use commit, but edit the commit message
    # e, edit = use commit, but stop for amending
    # s, squash = use commit, but meld into previous commit
    # f, fixup = like "squash", but discard this commit's log message
    # x, exec = run command (the rest of the line) using shell
    #
    # These lines can be re-ordered; they are executed from top to bottom.
    #
    # If you remove a line here THAT COMMIT WILL BE LOST.
    #
    # However, if you remove everything, the rebase will be aborted.
    #
    # Note that empty commits are commented out

    Replace pick with reword before each commit message you want to change.

    pick e499d89 Delete CNAME
    reword 0c39034 Better README
    reword f7fde4a Change the commit message but push the same commit.

    Save and close the commit list file.

    In each resulting commit file, type the new commit message, save the file, and close it.
++++++++++++++++++++++++


NÓTESE que no hay que hacer el "push" porque eso es para que los nuevos commits sustituyan
a los antiguos en el repositorio remoto... que yo no tengo en este caso.


git rebase -i HEAD~2
reword
:wq
[cambios con vi en el commit]:wq

Listo.


-------------------------------------------------------------------------------
[[RSG]] [[20190818]] 

D:\Instalaciones\GitHub reps\gztool>git checkout -b bgzip-compatible
Switched to a new branch 'bgzip-compatible'

D:\Instalaciones\GitHub reps\gztool>git branch
* bgzip-compatible
  master


-------------------------------------------------------------------------------
[[RSG]] [[20190822]] [[git]] [[merge]] [[tail_n_supervise]]  


odroid@odroid64:~/SD/dev/zlib/gztool$ git checkout master
Switched to branch 'master'
odroid@odroid64:~/SD/dev/zlib/gztool$ git branch
  bgzip-compatible
  * master

D:\Instalaciones\GitHub reps\gztool>git merge bgzip-compatible
Updating e1e73b5..8710fe8
Fast-forward
 README.md |  38 ++---
 gztool.c  | 468 ++++++++++++++++++++++++++++++++++++++++++++------------------
 2 files changed, 357 insertions(+), 149 deletions(-)


-------------------------------------------------------------------------------
[[RSG]] [[201908]] :<#trozos sueltos copiados> 


odroid@odroid64:~/SD/dev/zlib/gztool$ git rebase -i HEAD~2

It seems that there is already a rebase-merge directory, and
I wonder if you are in the middle of another rebase.  If that is the
case, please try
        git rebase (--continue | --abort | --skip)
If that is not the case, please
        rm -fr "/home/odroid/SD/dev/zlib/gztool/.git/rebase-merge"
and run me again.  I am stopping in case you still have something
valuable there.

odroid@odroid64:~/SD/dev/zlib/gztool$ git rebase --continue
bitácora - gztool.txt: needs update
gztool.c: needs update
You must edit all merge conflicts and then
mark them as resolved using git add


.................................................


-rw-rw-r-- 1 odroid odroid 251932599 Aug 18 18:49 TT.CLEAR




-------------------------------------------------------------------------------
[[RSG]] [[20190826]] [[incidencia]] 

EL primer índice (openldap.log.gzi.ERROR) no es usable... ¡está desplazado 8 bytes a partir del punto 9 inclusive cuando se lo compara con el segundo (hecho desde cero) que sí es usable!
Y sé que el punto 8 se escribió con la versión 0.6.283a, porque empezé con ella usando el gzi desde el punto 7,
y vi cómo añadía el 8:
    [root@motoko pool]# gunzip -c /var/log/openldap.log.gz | wc

    gunzip: /var/log/openldap.log.gz: unexpected end of file
     371471 5605014 73152920
    [root@motoko pool]# gztool -lll -I openldap.log.gzi /var/log/openldap.log.gz
    ACTION: Check & list info in index file

    Checking index file 'openldap.log.gzi' ...
    Index file is incomplete.
            Size of index file:        11596 Bytes (0.22%/gzip)
            Guessed gzip file name:    '/var/log/openldap.log.gz' ( 5304490 Bytes )
            Number of index points:    7
            List of points:
               @ compressed/uncompressed byte (compressed window size / uncompressed window size), ...
            Checking compressed windows...
            @ 10 / 0 ( 0/0 0.00% ), @ 1181008 / 10485763 ( 2512/32768 92.33% ), @ 2345755 / 20971858 ( 2631/32768 91.97% ), @ 3010946 / 31458485 ( 1736/32768 94.70% ), @ 3546583 / 41944605 ( 1587/32768 95.16% ), @ 4123678 / 52430426 ( 1800/32768 94.51% ), @ 4751728 / 62917451 ( 1130/32768 96.55% ),
            Estimated gzip data compression factor: 94.20%

    1 files processed

    [root@motoko pool]# gztool -lll -I openldap.log.gzi /var/log/openldap.log.gz
    ACTION: Check & list info in index file

    Checking index file 'openldap.log.gzi' ...
    Index file is incomplete.
            Size of index file:        12796 Bytes (0.24%/gzip)
            Guessed gzip file name:    '/var/log/openldap.log.gz' ( 5413035 Bytes )
            Number of index points:    8
            List of points:
               @ compressed/uncompressed byte (compressed window size / uncompressed window size), ...
            Checking compressed windows...
            @ 10 / 0 ( 0/0 0.00% ), @ 1181008 / 10485763 ( 2512/32768 92.33% ), @ 2345755 / 20971858 ( 2631/32768 91.97% ), @ 3010946 / 31458485 ( 1736/32768 94.70% ), @ 3546583 / 41944605 ( 1587/32768 95.16% ), @ 4123678 / 52430426 ( 1800/32768 94.51% ), @ 4751728 / 62917451 ( 1130/32768 96.55% ), @ 5314538 / 73403275 ( 1176/32768 96.41% ),
            Estimated gzip data compression factor: 94.52%

    1 files processed
    [root@motoko pool]# ls -l openldap.log.gzi
    -rw-r--r-- 1 root    root           23664 Aug 25 22:44 openldap.log.gzi


.................................................


D:\temporal\zlib\gztool\ERROR.2019>gztool -lll *gzi*
ACTION: Check & list info in index file

Checking index file 'openldap.log.gzi.ERROR' ...
Index file is incomplete.
        Size of index file:        23664 Bytes
        Number of index points:    14
        List of points:
           @ compressed/uncompressed byte (compressed window size / uncompressed window size), ...
        Checking compressed windows...
        @ 10 / 0 ( 0/0 0.00% ), @ 1181008 / 10485763 ( 2512/32768 92.33% ), @ 2345755 / 20971858 ( 2631/32768 91.97% ), @ 3010946 / 31458485 ( 1736/32768 94.70% ), @ 3546583 / 41944605 ( 1587/32768 95.16% ), @ 4123678 / 52430426 ( 1800/32768 94.51% ), @ 4751728 / 62917451 ( 1130/32768 96.55% ), @ 5314538 / 73403275 ( 1176/32768 96.41% ), @ 5848954 / 83889516 ( 2372/32768 92.76% ), @ 6397061 / 94376180 ( 1172/32768 96.42% ), @ 6932002 / 104862314 ( 1827/32768 94.42% ), @ 7504966 / 115348109 ( 1895/32768 94.22% ), @ 8141473 / 125834638 ( 1823/32768 94.44% ), @ 8700611 / 136320580 ( 1635/32768 95.01% ),
        Estimated gzip data compression factor: 94.53%

Checking index file 'openldap.log.gzi.ERROR.2' ...
Index file is incomplete.
        Size of index file:        23664 Bytes
        Number of index points:    14
        List of points:
           @ compressed/uncompressed byte (compressed window size / uncompressed window size), ...
        Checking compressed windows...
        @ 10 / 0 ( 0/0 0.00% ), @ 1181008 / 10485763 ( 2512/32768 92.33% ), @ 2345755 / 20971858 ( 2631/32768 91.97% ), @ 3010946 / 31458485 ( 1736/32768 94.70% ), @ 3546583 / 41944605 ( 1587/32768 95.16% ), @ 4123678 / 52430426 ( 1800/32768 94.51% ), @ 4751728 / 62917451 ( 1130/32768 96.55% ), @ 5314538 / 73403275 ( 1176/32768 96.41% ), @ 5848962 / 83889516 ( 2372/32768 92.76% ), @ 6397069 / 94376180 ( 1172/32768 96.42% ), @ 6932010 / 104862314 ( 1827/32768 94.42% ), @ 7504974 / 115348109 ( 1895/32768 94.22% ), @ 8141481 / 125834638 ( 1823/32768 94.44% ), @ 8700619 / 136320580 ( 1635/32768 95.01% ),
        Estimated gzip data compression factor: 94.53%

2 files processed

Vaya: ¡al parecer el gzip está terminado a la mitad!

D:\temporal\zlib\gztool\ERROR.2019>gztool -WI openldap.log.gzi.ERROR -b0 -v2 openldap.log.gz.ERROR | wc
ACTION: Extract from byte = 0

Index file 'openldap.log.gzi.ERROR' already exists and will be used.
Index file will NOT be modified.
Processing 'openldap.log.gz.ERROR' ...
Index file is incomplete.
Number of index points declared: 14
(8919609 >= 8700611)
Starting from index point 0 (@10=>0).
END OF GZIP passed @5548341 (totout=78044514, ftello=5554186)
140653804 bytes of data extracted.
ERROR: Compressed data error in 'openldap.log.gz.ERROR'.

Aborted.
1 files processed with errors!

 611467 10289867 140653804

Claramente es:
++++++++++++++++++++++++
            if ( ret.error == Z_STREAM_END &&
                 strm.avail_in >= 8 &&
                 decompressing_with_gzip_headers == 0 ) {
                // discard this data as it is probably the 8 gzip-tail bytes (4 CRC + 4 size%2^32)
                // and zlib is not able to consume it if inflateInit2(&strm, -15) (raw decompressing)
                strm.avail_in -= 8;
                strm.next_in += 8;
                printToStderr( VERBOSITY_EXCESSIVE, "END OF GZIP passed @%ld (totout=%ld, ftello=%ld)\n", totin, totout, ftello(in) );
+               totin+=8; // data is discarded from strm input, but it MUST be counted in total input
++++++++++++++++++++++++


-------------------------------------------------------------------------------


ed9cfce360999cd47f9af223d34a365c0530765f
ce947635fd78960c8031a74f13d908e7eca37c0d
f2c6278067c48e0abb06858f4bd8509a3183925d
2acf4f16aac688504f4f16aa37645f518b2b6854


8d14b7b576c932f588ef382a201e8fc9577cf145
c81a31792946a7b829f5dbc4ea5cfdf5fc110d89
629d503497df6567e7ff07c843ac4645acae2bdb
2a60fb97fd3164298597cd76ad224afc8d0a6254


-------------------------------------------------------------------------------
[[RSG]] [[20190828]] [[tag]] :<#renombrar un tag> 

D:\Instalaciones\GitHub reps\gztool>git tag v0.3.14 0.3.14

D:\Instalaciones\GitHub reps\gztool>git tag
0.3.14
v0.1
v0.2
v0.3.14
v0.3.141
v0.3.1415
v0.4
v0.4.1
v0.6.28
v0.6.283
v0.7

D:\Instalaciones\GitHub reps\gztool>git tag -d 0.3.14
Deleted tag '0.3.14' (was 2297a61)

D:\Instalaciones\GitHub reps\gztool>git push origin :refs/tags/0.3.14
To https://github.com/circulosmeos/gztool.git
 - [deleted]         0.3.14

D:\Instalaciones\GitHub reps\gztool>git push origin master --tags
Counting objects: 1, done.
Writing objects: 100% (1/1), 164 bytes | 82.00 KiB/s, done.
Total 1 (delta 0), reused 0 (delta 0)
To https://github.com/circulosmeos/gztool.git
 * [new tag]         v0.3.14 -> v0.3.14


-------------------------------------------------------------------------------
